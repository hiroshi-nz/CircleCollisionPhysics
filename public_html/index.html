<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Circle Collision Physics</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0px;
				background-color: #000000;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
                <div id="msg"></div>
                <input type="range" min="0" max="180" value="0" class="slider" id="myRange">
		<script src="three.min.js"></script>
                <script src="jquery-3.1.1.js"></script>


                <script src="Collision.js"></script>

		<script>
                    $(document).ready(function(){
                        var slider = document.getElementById("myRange");
                        slider.oninput = function(){
                            console.log(this.value);
                            var drawingGeometries = drawCircleCollision(this.value);
                            camera.update(cameraX, cameraY, cameraZ);
                            drawingGeometries.dispose();
                            
                        };
                        
			var camera, scene, renderer;
                        
                        //very important
                        var cameraX = 0;
                        var cameraY = 0;
                        var cameraZ = 10; 
                        
			init();
                          
                        $(document).keydown(function(event){
                            var keyCode = event.which;
                            console.log(keyCode);
                            if(keyCode === 49){//1
                                camera.switch();
                            } 
                            if(keyCode === 81){//Q
                            }                            
                            if(keyCode === 69){//E
                            }                            
                            if(keyCode === 87){//W
                                cameraY += 1;
                            }
                            if(keyCode === 83){//X
                                cameraY -= 1;
                            }
                            if(keyCode === 65){//A
                                cameraX -= 1;
                            }                            
                            if(keyCode === 68){//D
                                cameraX += 1;
                            }  
                            if(keyCode === 32){//space   
                            } 
                        });                      

                        function drawCircleCollision(angle){
                            /*
                            var pointGeometry = new THREE.CircleGeometry(0.15, 32);
                            var white = new THREE.MeshBasicMaterial({color: 0xffffff, transparent:false, side: THREE.DoubleSide});
                            var originM = new THREE.Mesh(pointGeometry, white);
                            originM.position.z = 0.01;
                            scene.add(originM);
                            */
                           
                            var circle1 = new PhysicsObjectCircle(2, -3, 0.5, 1, angle, 1);
                            var circle2 = new PhysicsObjectCircle(5, 5, 0.5, 0, 0, 0);
                            var physicsCollision =  new PhysicsCollision(circle1, circle2);
                            physicsCollision.createArrays();
                            
                            var drawingGeometries = new DrawGeometries(scene);
                            drawingGeometries.initializeCircles(physicsCollision.circles);
                            drawingGeometries.initializeLines(physicsCollision.lines);
                            drawingGeometries.initializePoints(physicsCollision.points);
                            drawingGeometries.draw();
                            
                            test();
                            return drawingGeometries;
                        }
                        
                        function test(){
                            console.log(scene.children);
                            console.log(scene);
                        }
                        
                        function Camera(scene, renderer){
                            this.perspevtiveCamera;
                            this.orthographicCamera;
                            this.isPerspective = true;
                            this.scene = scene;
                            this.renderer = renderer;

                            this.initialize = function(){
                                this.perspevtiveCamera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 1000 );
                                var size = 70;
                                this.orthographicCamera = new THREE.OrthographicCamera(size / - 2, size / 2, size / 2, size / - 2, 0.1, 1000);
                                //this.orthographicCamera.setViewOffset(100, 100, 10, -20, 100, 100);
                            };
                            this.initialize();
                            this.switch = function(){
                                if(this.isPerspective){
                                    this.isPerspective = false;
                                }else{      
                                    this.isPerspective = true;
                                }      
                            };
                            
                            this.update = function(cameraX, cameraY, cameraZ){
                                if(this.isPerspective){
                                    this.perspevtiveCamera.position.set(cameraX, cameraY, cameraZ);
                                    this.perspevtiveCamera.lookAt(new THREE.Vector3(cameraX, cameraY, cameraZ - 10));
                                    this.renderer.render(this.scene, this.perspevtiveCamera);
                                }else{//ortho
                                    var zOffset = 30;
                                    var yOffset = 30;
                                    this.orthographicCamera.position.set(-10, yOffset, zOffset);
                                    this.orthographicCamera.lookAt(new THREE.Vector3(10, yOffset, zOffset));
                                    this.renderer.render(this.scene, this.orthographicCamera);
                                }  
                            };
                            
                        }

			function init() {
                            scene = new THREE.Scene();
                            
                            loadInitMain();            
                            loadLight();
                            
                            var drawingGeometries = drawCircleCollision(0);
                            camera = new Camera(scene, renderer);
                            camera.update(cameraX, cameraY, cameraZ);
                            drawingGeometries.dispose();//needed be done after rendering
			}
                        
                        function loadInitMain(){
                            var size = 100;
                            var divisions = 100;

                            var gridHelper = new THREE.GridHelper(size, divisions);
                            gridHelper.rotateX(angleToRadian(90));
                            scene.add(gridHelper);

                            renderer = new THREE.WebGLRenderer();
                            renderer.setPixelRatio( window.devicePixelRatio );
                            renderer.setSize( window.innerWidth - 100, window.innerHeight -100);

                            renderer.shadowMapEnabled = true;
                            document.body.appendChild(renderer.domElement);
                            window.addEventListener( 'resize', onWindowResize, false );

                        }     
                        function loadLight(){
                            var keyLight = new THREE.DirectionalLight(new THREE.Color('hsl(30, 100%, 75%)'), 1.0);
                            keyLight.position.set(-1000, 0, 1000);
                            scene.add(keyLight);
                                
                            var fillLight = new THREE.DirectionalLight(new THREE.Color('hsl(240, 100%, 75%)'), 0.75);
                            fillLight.position.set(1000, 0, 1000);
                            scene.add(fillLight);

                            var backLight = new THREE.DirectionalLight(0xffffff, 1.0);
                            backLight.position.set(1000, 0, -1000);
                            scene.add(backLight);
                        }
			function onWindowResize() {//not working because of ortho?
				//camera.aspect = window.innerWidth / window.innerHeight;
				//camera.updateProjectionMatrix();
				//renderer.setSize( window.innerWidth-100, window.innerHeight-100 );
			}                         
                    });
			
		</script>
	</body>
</html>